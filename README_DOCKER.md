# Docker-—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Warehouse Manager

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –µ–¥–∏–Ω—ã–º `docker compose`-—Å—Ç–µ–∫–æ–º:

- **API (`warehouse-api`)** ‚Äî ASP.NET Core 8.0 Web API —Å–æ Swagger-UI (`http://localhost:5041/swagger`), –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–±–∏–ª—å–Ω—ã–º–∏/desktop-–∫–ª–∏–µ–Ω—Ç–∞–º–∏.
- **–ê–¥–º–∏–Ω–∫–∞ (`warehouse-admin`)** ‚Äî ASP.NET Core MVC –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`http://localhost:5080`), —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ API.
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (`warehouse-db`)** ‚Äî Microsoft SQL Server 2022, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ `WarehouseManager.bak` –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—ë—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ApplicationMetrics`).

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. Docker Desktop 4.27+ (–∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π Docker Engine) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Compose v2.
2. –í –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–æ–ª–∂–µ–Ω –ª–µ–∂–∞—Ç—å —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞ `WarehouseManager.bak`.
3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` —Ä—è–¥–æ–º —Å `docker-compose.yml` (–º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `env.example`) –∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
   ```dotenv
   SA_PASSWORD=YourStrong!Passw0rd   # —Å–ª–æ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω. 8 —Å–∏–º–≤–æ–ª–æ–≤, —Ü–∏—Ñ—Ä–∞, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª)
   DB_NAME=WarehouseManager
   DB_LOGICAL_DATA_NAME=WarehouseManager
   DB_LOGICAL_LOG_NAME=WarehouseManager_log
   API_ASPNETCORE_ENVIRONMENT=Development
   ADMIN_ASPNETCORE_ENVIRONMENT=Development
   ```
   > `SA_PASSWORD` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –∏–Ω–∞—á–µ compose –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```
WarehouseManagerApi/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ env.example
‚îú‚îÄ‚îÄ WarehouseManager.bak               # –±—ç–∫–∞–ø –ë–î, –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îî‚îÄ‚îÄ docker/
    ‚îî‚îÄ‚îÄ sql/
        ‚îú‚îÄ‚îÄ restore-db.sh              # entrypoint –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ SQL, –≤—ã–ø–æ–ª–Ω—è–µ—Ç RESTORE
        ‚îî‚îÄ‚îÄ post-restore.sql           # —Å–æ–∑–¥–∞—ë—Ç ApplicationMetrics –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏
```

## –ó–∞–ø—É—Å–∫ —Å—Ç–µ–∫–∞

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–±–æ—Ä–∫—É –∏ –∑–∞–ø—É—Å–∫:
   ```bash
   docker compose up -d --build
   ```
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å:
   ```bash
   docker compose ps
   ```
   –û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ—Ä—Ç—ã:
   - API: `http://localhost:5041` (Swagger –ø–æ `/swagger`)
   - Admin UI: `http://localhost:5080`
   - SQL Server: `localhost,1433`

3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - `restore-db.sh` —Å—Ç–∞—Ä—Ç—É–µ—Ç SQL Server, –∂–¥—ë—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `RESTORE DATABASE` –∏–∑ `.bak`, –µ—Å–ª–∏ –±–∞–∑—ã –µ—â—ë –Ω–µ—Ç.
   - –ü–æ—Å–ª–µ —Ä–µ—Å—Ç–æ—Ä–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `post-restore.sql`, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã/–∏–Ω–¥–µ–∫—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ApplicationMetrics`).
   - –í –ª–æ–≥–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (`docker compose logs db`) –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å (`RESTORE DATABASE successfully processed ...`).

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç—Ä–∏–º –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose logs -f api
docker compose logs -f admin
docker compose logs -f db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è
docker compose restart api admin db

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose down          # –æ—Å—Ç–∞–≤–∏—Ç—å volume mssql-data
docker compose down -v       # —É–¥–∞–ª–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –¥–∞–Ω–Ω—ã–º–∏

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQL Server –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec -it warehouse-db \
  /opt/mssql-tools18/bin/sqlcmd -S localhost -U SA -P "<–ø–∞—Ä–æ–ª—å>"
```

## –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

- **`required variable SA_PASSWORD is missing`** ‚Äî –Ω–µ —Å–æ–∑–¥–∞–Ω `.env` –∏–ª–∏ –ø–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π. –û–±–Ω–æ–≤–∏—Ç–µ `.env` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ `docker compose up -d`.
- **API/–∞–¥–º–∏–Ω–∫–∞ –Ω–µ –æ—Ç–≤–µ—á–∞—é—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞** ‚Äî –¥–æ–∂–¥–∏—Ç–µ—Å—å —Å—Ç–∞—Ç—É—Å–∞ `healthy` —É `warehouse-db`. –ü–æ–∫–∞ –ë–î –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, API –Ω–µ —Å–º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è.
- **–ù–µ—Ç —Ç–∞–±–ª–∏—Ü—ã `ApplicationMetrics`** ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `db` –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ø–æ—Å–ª–µ 24.11.2025 02:43. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–¥–∞–ª–∏—Ç–µ volume `mssql-data` (`docker compose down -v`) –∏ –ø–æ–¥–Ω–∏–º–∏—Ç–µ —Å—Ç–µ–∫ –∑–∞–Ω–æ–≤–æ ‚Äî —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- **–•–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `docker compose down -v`, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ `docker compose up -d --build`.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- –í –ø—Ä–æ–µ–∫—Ç–µ –æ—Å—Ç–∞—é—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `prometheus/` –∏ `grafana/` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞. –ò—Ö –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤ compose –ø–æ–∑–∂–µ, –Ω–æ –±–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ API/–∞–¥–º–∏–Ω–∫–∏ –æ—Ç –Ω–∏—Ö –Ω–µ –∑–∞–≤–∏—Å–∏—Ç.
- –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ API/–∞–¥–º–∏–Ω–∫–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ `docker compose up -d --build`, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã.

–¢–µ–ø–µ—Ä—å –≤–µ—Å—å —Å—Ç–µ–∫ –º–æ–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π, –∏–º–µ—è —Ç–æ–ª—å–∫–æ Docker –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ `docker compose logs db`, –∑–∞—Ç–µ–º `api` –∏ `admin`. –£–¥–∞—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã! üòä

