<UserControl x:Class="WarehouseManager.Wpf.View.AnalyticsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:oxy="http://oxyplot.org/wpf"
             mc:Ignorable="d"
             d:DesignWidth="1200"
             d:DesignHeight="800">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Orientation="Vertical">
                <TextBlock Text="Аналитика"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="#123C69"
                           Margin="0,0,0,10"/>
                <TextBlock Text="Обновлённые сведения по складам, заказам и категориям"
                           FontSize="16"
                           Foreground="#666666"
                           Margin="0,0,0,16"/>

                <!-- Сообщение об ошибке -->
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="#AC3B61"
                           TextWrapping="Wrap"
                           Margin="0,0,0,16"
                           Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"/>

                <!-- Индикатор загрузки -->
                <StackPanel Orientation="Horizontal"
                            VerticalAlignment="Center"
                            Margin="0,0,0,16">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Загрузка данных аналитики..."
                               FontStyle="Italic"
                               Foreground="#666666"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Grid.Row="1"
                        Margin="0,20,0,0"
                        Orientation="Vertical"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Top">
                <!-- График запасов по складам -->
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Склад:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding SelectedWarehouseId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="Address"
                                          ItemsSource="{Binding Warehouses}"
                                          Width="200"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <oxy:PlotView Model="{Binding WarehouseStockPlot}"
                                      Height="240"
                                      Background="Transparent" />
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,12,0,0">
                            <Button Content="В CSV"
                                    Command="{Binding ExportCsvCommand}"
                                    CommandParameter="WarehouseStock"
                                    Margin="0,0,8,0"
                                    Padding="10,6"
                                    Background="#BAB2B5"
                                    Foreground="#123C69"
                                    BorderBrush="#8D8D8D"
                                    Cursor="Hand"/>
                            <Button Content="В PDF"
                                    Command="{Binding ExportPdfCommand}"
                                    CommandParameter="WarehouseStock"
                                    Padding="10,6"
                                    Background="#123C69"
                                    Foreground="#EEE2DC"
                                    BorderBrush="#BAB2B5"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                <!-- График статусов заказов -->
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Период:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding StartDate}"
                                            Width="120"
                                            Margin="0,0,8,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="по"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding EndDate}"
                                            Width="120"
                                            Margin="0,0,16,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="Статус:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding SelectedOrderStatusId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="StatusName"
                                          ItemsSource="{Binding OrderStatuses}"
                                          Width="150"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <oxy:PlotView Model="{Binding OrderStatusPlot}"
                                      Height="240"
                                      Background="Transparent" />
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,12,0,0">
                            <Button Content="В CSV"
                                    Command="{Binding ExportCsvCommand}"
                                    CommandParameter="OrderStatus"
                                    Margin="0,0,8,0"
                                    Padding="10,6"
                                    Background="#BAB2B5"
                                    Foreground="#123C69"
                                    BorderBrush="#8D8D8D"
                                    Cursor="Hand"/>
                            <Button Content="В PDF"
                                    Command="{Binding ExportPdfCommand}"
                                    CommandParameter="OrderStatus"
                                    Padding="10,6"
                                    Background="#123C69"
                                    Foreground="#EEE2DC"
                                    BorderBrush="#BAB2B5"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                <!-- График товаров по категориям -->
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Категория:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding SelectedCategoryId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="Name"
                                          ItemsSource="{Binding Categories}"
                                          Width="200"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <oxy:PlotView Model="{Binding CategoryProductCountPlot}"
                                      Height="240"
                                      Background="Transparent" />
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,12,0,0">
                            <Button Content="В CSV"
                                    Command="{Binding ExportCsvCommand}"
                                    CommandParameter="CategoryProductCount"
                                    Margin="0,0,8,0"
                                    Padding="10,6"
                                    Background="#BAB2B5"
                                    Foreground="#123C69"
                                    BorderBrush="#8D8D8D"
                                    Cursor="Hand"/>
                            <Button Content="В PDF"
                                    Command="{Binding ExportPdfCommand}"
                                    CommandParameter="CategoryProductCount"
                                    Padding="10,6"
                                    Background="#123C69"
                                    Foreground="#EEE2DC"
                                    BorderBrush="#BAB2B5"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                <!-- График выручки по месяцам -->
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="280">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Год:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedItem="{Binding SelectedYear}"
                                          ItemsSource="{Binding AvailableYears}"
                                          Width="100"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <oxy:PlotView Model="{Binding MonthlyRevenuePlot}"
                                      Height="240"
                                      Background="Transparent" />
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,12,0,0">
                            <Button Content="В CSV"
                                    Command="{Binding ExportCsvCommand}"
                                    CommandParameter="MonthlyRevenue"
                                    Margin="0,0,8,0"
                                    Padding="10,6"
                                    Background="#BAB2B5"
                                    Foreground="#123C69"
                                    BorderBrush="#8D8D8D"
                                    Cursor="Hand"/>
                            <Button Content="В PDF"
                                    Command="{Binding ExportPdfCommand}"
                                    CommandParameter="MonthlyRevenue"
                                    Padding="10,6"
                                    Background="#123C69"
                                    Foreground="#EEE2DC"
                                    BorderBrush="#BAB2B5"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                <!-- График топ категорий по выручке -->
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Период:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding StartDate}"
                                            Width="120"
                                            Margin="0,0,8,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="по"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding EndDate}"
                                            Width="120"
                                            Margin="0,0,16,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="Категория:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding SelectedCategoryId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="Name"
                                          ItemsSource="{Binding Categories}"
                                          Width="150"
                                          Margin="0,0,16,0"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <TextBlock Text="Топ:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedItem="{Binding TopCount}"
                                          ItemsSource="{Binding AvailableTopCounts}"
                                          Width="80"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <oxy:PlotView Model="{Binding TopCategoryRevenuePlot}"
                                      Height="240"
                                      Background="Transparent" />
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,12,0,0">
                            <Button Content="В CSV"
                                    Command="{Binding ExportCsvCommand}"
                                    CommandParameter="TopCategoryRevenue"
                                    Margin="0,0,8,0"
                                    Padding="10,6"
                                    Background="#BAB2B5"
                                    Foreground="#123C69"
                                    BorderBrush="#8D8D8D"
                                    Cursor="Hand"/>
                            <Button Content="В PDF"
                                    Command="{Binding ExportPdfCommand}"
                                    CommandParameter="TopCategoryRevenue"
                                    Padding="10,6"
                                    Background="#123C69"
                                    Foreground="#EEE2DC"
                                    BorderBrush="#BAB2B5"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                <!-- График производительности сотрудников -->
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Период:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding StartDate}"
                                            Width="120"
                                            Margin="0,0,8,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="по"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding EndDate}"
                                            Width="120"
                                            Margin="0,0,16,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="Топ:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedItem="{Binding TopCount}"
                                          ItemsSource="{Binding AvailableTopCounts}"
                                          Width="80"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <oxy:PlotView Model="{Binding EmployeePerformancePlot}"
                                      Height="240"
                                      Background="Transparent" />
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,12,0,0">
                            <Button Content="В CSV"
                                    Command="{Binding ExportCsvCommand}"
                                    CommandParameter="EmployeePerformance"
                                    Margin="0,0,8,0"
                                    Padding="10,6"
                                    Background="#BAB2B5"
                                    Foreground="#123C69"
                                    BorderBrush="#8D8D8D"
                                    Cursor="Hand"/>
                            <Button Content="В PDF"
                                    Command="{Binding ExportPdfCommand}"
                                    CommandParameter="EmployeePerformance"
                                    Padding="10,6"
                                    Background="#123C69"
                                    Foreground="#EEE2DC"
                                    BorderBrush="#BAB2B5"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Период:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding StartDate}"
                                            Width="120"
                                            Margin="0,0,8,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="по"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding EndDate}"
                                            Width="120"
                                            Margin="0,0,16,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="Категория:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding SelectedCategoryId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="Name"
                                          ItemsSource="{Binding Categories}"
                                          Width="150"
                                          Margin="0,0,16,0"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <TextBlock Text="Топ:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedItem="{Binding TopCount}"
                                          ItemsSource="{Binding AvailableTopCounts}"
                                          Width="80"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <TextBlock Text="Топ категорий (выручка и продажи)"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding TopCategoryRevenue}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Категория" Binding="{Binding CategoryName}" Width="*"/>
                                <DataGridTextColumn Header="Выручка" Binding="{Binding TotalRevenue, StringFormat='{}{0:F2} ₽'}" Width="160"/>
                                <DataGridTextColumn Header="Продано единиц" Binding="{Binding TotalUnits}" Width="140"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Период:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding StartDate}"
                                            Width="120"
                                            Margin="0,0,8,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="по"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding EndDate}"
                                            Width="120"
                                            Margin="0,0,16,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="Склад:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding SelectedWarehouseId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="Address"
                                          ItemsSource="{Binding Warehouses}"
                                          Width="200"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <TextBlock Text="Статистика выполнения заказов по складам"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding WarehouseOrderStats}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Склад" Binding="{Binding WarehouseAddress}" Width="*"/>
                                <DataGridTextColumn Header="Заказов" Binding="{Binding TotalOrders}" Width="110"/>
                                <DataGridTextColumn Header="Активных" Binding="{Binding ActiveOrders}" Width="110"/>
                                <DataGridTextColumn Header="Отменённых" Binding="{Binding CancelledOrders}" Width="130"/>
                                <DataGridTextColumn Header="Завершённых" Binding="{Binding CompletedOrders}" Width="140"/>
                                <DataGridTextColumn Header="Выручка" Binding="{Binding TotalRevenue, StringFormat='{}{0:F2} ₽'}" Width="160"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Период:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding StartDate}"
                                            Width="120"
                                            Margin="0,0,8,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="по"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <DatePicker SelectedDate="{Binding EndDate}"
                                            Width="120"
                                            Margin="0,0,16,0"
                                            Background="#EDC7B7"
                                            Foreground="#123C69"
                                            BorderBrush="#BAB2B5"
                                            BorderThickness="1"/>
                                <TextBlock Text="Топ:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedItem="{Binding TopCount}"
                                          ItemsSource="{Binding AvailableTopCounts}"
                                          Width="80"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <TextBlock Text="Показатели сотрудников"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding EmployeePerformanceDetails}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Сотрудник" Binding="{Binding EmployeeName}" Width="*"/>
                                <DataGridTextColumn Header="Обработано заказов" Binding="{Binding OrdersHandled}" Width="170"/>
                                <DataGridTextColumn Header="Выручка" Binding="{Binding TotalRevenue, StringFormat='{}{0:F2} ₽'}" Width="150"/>
                                <DataGridTextColumn Header="Среднее время, ч" Binding="{Binding AverageProcessingHours, StringFormat='{}{0:F1}'}" Width="160"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Категория:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding SelectedCategoryId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="Name"
                                          ItemsSource="{Binding Categories}"
                                          Width="200"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <TextBlock Text="Статистика цен по категориям"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding CategoryPriceStats}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Категория" Binding="{Binding CategoryName}" Width="*"/>
                                <DataGridTextColumn Header="Кол-во товаров" Binding="{Binding ProductCount}" Width="130"/>
                                <DataGridTextColumn Header="Средняя цена" Binding="{Binding AveragePrice, StringFormat='{}{0:F2} ₽'}" Width="140"/>
                                <DataGridTextColumn Header="Мин. цена" Binding="{Binding MinPrice, StringFormat='{}{0:F2} ₽'}" Width="120"/>
                                <DataGridTextColumn Header="Макс. цена" Binding="{Binding MaxPrice, StringFormat='{}{0:F2} ₽'}" Width="120"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <Border Background="#EEE2DC"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Склад:"
                                           Foreground="#123C69"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding SelectedWarehouseId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="Address"
                                          ItemsSource="{Binding Warehouses}"
                                          Width="200"
                                          Background="#EDC7B7"
                                          Foreground="#123C69"
                                          BorderBrush="#BAB2B5"
                                          BorderThickness="1"/>
                                <Button Content="Обновить"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Padding="12,6"
                                        Margin="16,0,0,0"
                                        Background="#123C69"
                                        Foreground="#EEE2DC"
                                        BorderBrush="#BAB2B5"
                                        Cursor="Hand"
                                        FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <TextBlock Text="Детализация по складам"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding WarehouseStockDetails}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Склад" Binding="{Binding WarehouseAddress}" Width="*"/>
                                <DataGridTextColumn Header="Площадь (м²)" Binding="{Binding Square}" Width="120"/>
                                <DataGridTextColumn Header="Уникальных товаров" Binding="{Binding DistinctProducts}" Width="160"/>
                                <DataGridTextColumn Header="Всего позиций" Binding="{Binding TotalQuantity}" Width="130"/>
                                <DataGridTextColumn Header="Суммарная стоимость" Binding="{Binding TotalValue, StringFormat='{}{0:F2} ₽'}" Width="160"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</UserControl>

