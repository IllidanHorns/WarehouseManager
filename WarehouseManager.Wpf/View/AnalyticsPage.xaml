<UserControl x:Class="WarehouseManager.Wpf.View.AnalyticsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:oxy="http://oxyplot.org/wpf"
             mc:Ignorable="d"
             d:DesignWidth="1200"
             d:DesignHeight="800">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Orientation="Vertical">
                <TextBlock Text="Аналитика"
                           FontSize="28"
                           FontWeight="Bold"
                           Margin="0,0,0,10"/>
                <TextBlock Text="Обновлённые сведения по складам, заказам и категориям"
                           FontSize="16"
                           Foreground="#666666"
                           Margin="0,0,0,8"/>
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="Crimson">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </Trigger>
                                <Trigger Property="Text" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <StackPanel Orientation="Horizontal"
                            VerticalAlignment="Center">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Загрузка данных аналитики..."
                               FontStyle="Italic"
                               Foreground="#666666"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Grid.Row="1"
                        Margin="0,20,0,0"
                        Orientation="Vertical"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Top">
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <oxy:PlotView Model="{Binding WarehouseStockPlot}"
                                  Background="Transparent" />
                </Border>
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <oxy:PlotView Model="{Binding OrderStatusPlot}"
                                  Background="Transparent" />
                </Border>
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <oxy:PlotView Model="{Binding CategoryProductCountPlot}"
                                  Background="Transparent" />
                </Border>
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="280">
                    <oxy:PlotView Model="{Binding MonthlyRevenuePlot}"
                                  Background="Transparent" />
                </Border>
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <oxy:PlotView Model="{Binding TopCategoryRevenuePlot}"
                                  Background="Transparent" />
                </Border>
                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        MinHeight="260">
                    <oxy:PlotView Model="{Binding EmployeePerformancePlot}"
                                  Background="Transparent" />
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Топ категорий (выручка и продажи)"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding TopCategoryRevenue}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Категория" Binding="{Binding CategoryName}" Width="*"/>
                                <DataGridTextColumn Header="Выручка" Binding="{Binding TotalRevenue, StringFormat='{}{0:F2} ₽'}" Width="160"/>
                                <DataGridTextColumn Header="Продано единиц" Binding="{Binding TotalUnits}" Width="140"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Статистика выполнения заказов по складам"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding WarehouseOrderStats}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Склад" Binding="{Binding WarehouseAddress}" Width="*"/>
                                <DataGridTextColumn Header="Заказов" Binding="{Binding TotalOrders}" Width="110"/>
                                <DataGridTextColumn Header="Активных" Binding="{Binding ActiveOrders}" Width="110"/>
                                <DataGridTextColumn Header="Отменённых" Binding="{Binding CancelledOrders}" Width="130"/>
                                <DataGridTextColumn Header="Завершённых" Binding="{Binding CompletedOrders}" Width="140"/>
                                <DataGridTextColumn Header="Выручка" Binding="{Binding TotalRevenue, StringFormat='{}{0:F2} ₽'}" Width="160"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Показатели сотрудников"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding EmployeePerformanceDetails}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Сотрудник" Binding="{Binding EmployeeName}" Width="*"/>
                                <DataGridTextColumn Header="Обработано заказов" Binding="{Binding OrdersHandled}" Width="170"/>
                                <DataGridTextColumn Header="Выручка" Binding="{Binding TotalRevenue, StringFormat='{}{0:F2} ₽'}" Width="150"/>
                                <DataGridTextColumn Header="Среднее время, ч" Binding="{Binding AverageProcessingHours, StringFormat='{}{0:F1}'}" Width="160"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Статистика цен по категориям"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding CategoryPriceStats}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Категория" Binding="{Binding CategoryName}" Width="*"/>
                                <DataGridTextColumn Header="Кол-во товаров" Binding="{Binding ProductCount}" Width="130"/>
                                <DataGridTextColumn Header="Средняя цена" Binding="{Binding AveragePrice, StringFormat='{}{0:F2} ₽'}" Width="140"/>
                                <DataGridTextColumn Header="Мин. цена" Binding="{Binding MinPrice, StringFormat='{}{0:F2} ₽'}" Width="120"/>
                                <DataGridTextColumn Header="Макс. цена" Binding="{Binding MaxPrice, StringFormat='{}{0:F2} ₽'}" Width="120"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <Border Margin="0,0,0,20"
                        Padding="10"
                        Background="White"
                        CornerRadius="8"
                        BorderBrush="#DDD"
                        BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Детализация по складам"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#123C69"
                                   Margin="0,0,0,12"/>
                        <DataGrid ItemsSource="{Binding WarehouseStockDetails}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  Background="Transparent"
                                  Foreground="#123C69"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  RowBackground="#EDC7B7"
                                  AlternatingRowBackground="#F4D4C4"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="#123C69"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="BorderBrush" Value="#D8C3A5"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="4,0,0,8"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Склад" Binding="{Binding WarehouseAddress}" Width="*"/>
                                <DataGridTextColumn Header="Площадь (м²)" Binding="{Binding Square}" Width="120"/>
                                <DataGridTextColumn Header="Уникальных товаров" Binding="{Binding DistinctProducts}" Width="160"/>
                                <DataGridTextColumn Header="Всего позиций" Binding="{Binding TotalQuantity}" Width="130"/>
                                <DataGridTextColumn Header="Суммарная стоимость" Binding="{Binding TotalValue, StringFormat='{}{0:F2} ₽'}" Width="160"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</UserControl>

